# Example configuration for Transub

# --- Whisper Transcription ---------------------------------------------------
[whisper]
backend = "local"  # Options: "local", "api", "mlx", "cpp"
model = "small"
device = "cpu"
language = "en"  # Source language code (e.g., "en", "zh", "ja"). Leave empty for auto-detection
tune_segmentation = true  # Apply optimized segmentation settings to reduce fragmented subtitles
initial_prompt = ""  # Optional text to help Whisper with terminology, context, or style
word_timestamps = true  # Extract word-level timestamps for precise timing and intelligent splitting (strongly recommended)

# For API backend (cloud transcription):
# backend = "api"
# model = "whisper-1"
# api_key_env = "OPENAI_API_KEY"  # or use a different env var if needed

# --- Translation Model -------------------------------------------------------
[llm]
provider = "openai"
model = "gpt-4o-mini"
api_base = ""
api_key_env = "OPENAI_API_KEY"  # Same as Whisper by default if both use OpenAI
temperature = 0.2
max_retries = 3
request_timeout = 60.0
batch_size = 5
target_language = "zh"
style = "Simplified Chinese"

# --- Pipeline Behaviour ------------------------------------------------------
[pipeline]
output_format = "srt"  # Subtitle format: "srt" or "vtt"
audio_format = "wav"  # Intermediate audio format: "wav", "mp3", "flac", "m4a", or "ogg"
output_dir = "./output"  # Directory where subtitle files will be saved
keep_temp_audio = false  # Set to true to keep extracted audio files for debugging
save_source_subtitles = true  # Save source language subtitles alongside translated ones

# Display width settings for source subtitles (professional quality, word-timestamps required)
max_display_width = 42.0  # Industry standard: 42 units for single-line display (CJK chars count as 2)
min_display_width = 20.0  # Minimum width to avoid very short lines (orphaned words auto-merged)
prefer_sentence_boundaries = true  # Prioritize splitting at sentence/phrase endings for better readability

# Display width settings for translated subtitles
translation_max_display_width = 30.0  # Suitable for CJK languages (shorter than English)
translation_min_display_width = 15.0  # Minimum for translated lines

timing_offset_seconds = 0.0  # Global time shift in seconds (positive delays, negative advances subtitles)
min_line_duration = 1.2  # Minimum duration for each subtitle line in seconds (professional standard: 1.0-1.5s to avoid "flash" subtitles)
max_cps = 20.0  # Maximum characters per second (CPS) to prevent information overload (20 for mixed text, 12-15 for CJK-only)

# Intelligent splitting and pause detection (requires word_timestamps=true)
pause_threshold_seconds = 0.3  # Minimum gap between words to consider as a natural pause for splitting
silence_threshold_seconds = 2.0  # Minimum gap to consider as long silence (segments removed if remove_silence_segments=true)
remove_silence_segments = true  # Automatically remove subtitle lines containing only long silences

# Subtitle refinement options
remove_trailing_punctuation = true  # Remove trailing punctuation from translated subtitles
simplify_cjk_punctuation = false  # Replace commas/periods with spaces (common style for Chinese subtitles)
normalize_cjk_spacing = true  # Insert spaces between CJK characters and Latin/digit sequences
refine_source_subtitles = false  # Re-refine source subtitles when exporting (usually not needed)
prompt_preamble = """
# Role: Senior Subtitle Translator
You are an experienced subtitle translator who delivers clear, natural ${targetLanguage} subtitles.

# Guidelines
1. Keep each subtitle line independent; never merge or split entries.
2. Prefer conversational ${targetLanguage} that reads well in subtitles.
3. Use punctuation (comma, period, ellipsis) to preserve rhythm and tone.
4. Translate terminology accurately and keep it consistent across lines.
5. Use straight quotes instead of curly quotes.
6. When the translation mixes different scripts (for example, Latin letters within Chinese text), add spacing where appropriate so the subtitle stays legible.

# Output Format
1. Return a JSON object that mirrors the input keys (IDs) and only translates the values.
2. Do not add commentary or text outside the JSON object.
3. Ensure the JSON is syntactically valid and contains the same number of entries as the input.

Review your work to confirm the translation is fluent, faithful to the source, and grammatically correct. Adapt passive/active voice as needed for natural ${targetLanguage} subtitles.

# Example

Input:
{"0": "Welcome to China", "1": "China is a beautiful country"}

Output:
{"0": "欢迎来到中国", "1": "中国是一个美丽的国家"}
"""
